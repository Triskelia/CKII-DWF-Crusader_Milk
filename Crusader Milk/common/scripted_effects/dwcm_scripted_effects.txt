dwcm_get_lacteria_test_subject = {
		if = { # We check if our last test subject is still available
			limit = {
				event_target:dwcm_lacteria_test_subject = { 
					character = yes
					is_alive = yes
					prisoner = no
					is_incapable = no
				} 
			}
		}
		else_if = { # Otherwise, we check to see if we've another subject we can use
			limit = {
				location = {
					any_province_character = {
						is_female = yes
						is_adult = yes
						age < 40
						prisoner = no
						is_incapable = no
						ai = yes #we don't want the player being pulled into these events against their will
					}
				}
			}
			#If there is, we then grab one for the event
			location = {
				random_province_character = {
					limit = {
						is_female = yes
						is_adult = yes
						age < 40
						prisoner = no
						is_incapable = no
						ai = yes
					}
					save_event_target_as = dwcm_lacteria_test_subject
				}
			}
		}
}

dcwm_milk_breasts = {
	if = {
		limit = {
			trait = engorged_breasts
		}
		remove_trait = engorged_breasts	
	}
	set_variable = { which = dwcm_breast_fullness value = 0 }
	add_character_modifier = {
		modifier = recently_milked
		duration = 180
	}
	
	  #TODO add a chance to remove stressed or depressed trait
}

dwcm_increase_breast_fullness = {
	if = {
		limit = { NOT = { check_variable = { which = dwcm_breast_fullness which = dwcm_total_milk_capacity } } }
		dwcm_set_total_milk_production_rate = yes
		change_variable = { which = dwcm_breast_fullness which = dwcm_total_milk_production_rate }
		if = {
			limit = { check_variable = { which = dwcm_breast_fullness which = dwcm_total_milk_capacity } }
			set_variable = { which = dwcm_breast_fullness which = dwcm_total_milk_capacity }
		}
	}
}

dwcm_set_base_milk_capacity = {
	trigger_switch = {
		on_trigger = trait
		gigantic_tits = { set_variable = { which = dwcm_base_milk_capacity value = 3.5 } }
		enormous_tits = { set_variable = { which = dwcm_base_milk_capacity value = 3 } }
		huge_tits = { set_variable = { which = dwcm_base_milk_capacity value = 2.5 } }
		big_tits = { set_variable = { which = dwcm_base_milk_capacity value = 2 } }
		regular_tits = { set_variable = { which = dwcm_base_milk_capacity value = 1.5 } }
		small_tits = { set_variable = { which = dwcm_base_milk_capacity value = 1 } }
		tiny_tits = { set_variable = { which = dwcm_base_milk_capacity value = 0.5 } }
	}
}

dwcm_set_total_milk_capacity = {
	set_variable = { which = dwcm_total_milk_capacity which = dwcm_base_milk_capacity }
	#TODO Add potential milk capacity bonuses
}

dwcm_set_base_milk_production_rate = {
	trigger_switch = {
		on_trigger = trait
		gigantic_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.5 } }
		enormous_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.47 } }
		huge_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.41 } }
		big_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.34 } }
		regular_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.26 } }
		small_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.18 } }
		tiny_tits = { set_variable = { which = dwcm_base_milk_production_rate value = 0.12 } }
	}
}

dwcm_set_base_milk_production_multiplier = {
	set_variable = { which = dwcm_milk_production_multiplier value = 1 }
	#TODO Add potential multiplier (idea: fuckable nipples from DWF: tentacles)
}

dwcm_set_total_milk_production_rate = {
	set_variable = { which = dwcm_total_milk_production_rate which = dwcm_base_milk_production_rate }
	multiply_variable = { which = dwcm_total_milk_production_rate which = dwcm_milk_production_multiplier }
}